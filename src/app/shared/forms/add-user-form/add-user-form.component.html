<app-generic-form [title]="'Add New User'" (closeModal)="closeMenu()">
<form class="p-2" [formGroup]="form">

    <!-- 1st -->
    <div class="mb-6">
        <h3 class="text-lg font-bold text-black dark:text-[#eee] mb-3">User Information</h3>
        <div class="flex-1 min-w-[200px]">
            <label class="block text-sm font-medium text-black dark:text-gray-400 mb-2">Username</label>
            <input  placeholder="Enter Employee's First Name"
            class="px-3 py-2 
            text-md text-gray-800 dark:text-gray-100
            input-class w-full 
            bg-white dark:bg-[#2a2b2f] 
            rounded border border-gray-300 dark:border-gray-700 
            focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none"                     
            formControlName="userName">
            <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['userName'].invalid && form.controls['userName'].touched">
            Please Enter Username
            </p>
            <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['userName'].errors?.['pattern']">
                Special characters are not allowed.
            </p>
            <p class="text-blue-500 text-sm mt-2" >
                The Username will be : {{ username }}&#64;{{subDomain}}
            </p>
        </div>
    </div>
    <!-- 2nd -->
    <div class="mb-2">
        <div class="flex flex-wrap gap-2">
            <div class="flex-1 min-w-[200px]">
                <label class="block text-sm font-medium text-black dark:text-gray-400 mb-2">Password</label>
                <div class="relative">
                    <input  placeholder="Enter Password"
                    [type]="showPassword ? 'text' : 'password'" 
                    class="px-3 py-2 
                    text-md text-gray-800 dark:text-gray-100
                    input-class w-full 
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none"                     
                    formControlName="password">
                    <button type="button" (click)="togglePassword()" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-600">
                        <span *ngIf="!showPassword"><i class="bi bi-eye-fill"></i></span>
                        <span *ngIf="showPassword"><i class="bi bi-eye-slash-fill"></i></span>
                    </button>
                </div>
                <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['password'].errors?.['required'] && form.controls['password'].touched">
                Please Enter Password
                </p>
            </div>
            <div class="flex-1 min-w-[200px]">
                <label class="block text-sm font-medium text-black dark:text-gray-400 mb-2">Confirm Password</label>
                <div class="relative">
                    <input  placeholder="Enter Confirm Password"
                    [type]="showPassword ? 'text' : 'password'" 
                    class="px-3 py-2 
                    text-md text-gray-800 dark:text-gray-100
                    input-class w-full 
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none"                     
                    formControlName="confirmPassword">
                    <button type="button" (click)="togglePassword()" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-600">
                        <span *ngIf="!showPassword"><i class="bi bi-eye-fill"></i></span>
                        <span *ngIf="showPassword"><i class="bi bi-eye-slash-fill"></i></span>
                    </button>
                </div>
                <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['confirmPassword'].errors?.['required']  && form.controls['confirmPassword'].touched">
                Please Enter Confirm Password
                </p>
            </div>
        </div>
    </div>
    <p class="text-red-500 text-sm my-3"
    *ngIf="form.controls['confirmPassword'].errors?.['passwordMismatch'] && form.controls['confirmPassword'].touched">
    Passwords do not match.
    </p>
    <!-- 3rd-->
    <div class="mb-6">
        <div class="flex flex-wrap gap-4">
            <!-- Role -->
            <div class="flex-1 min-w-[250px]">
                <label class="block text-sm font-medium text-black dark:text-gray-400 mb-2">Role</label>
                <select class="px-3 py-2 
                w-[50%]
                text-md text-gray-800 dark:text-gray-100
                bg-white dark:bg-[#2a2b2f] 
                rounded border border-gray-300 dark:border-gray-700 
                focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none"
                formControlName="roleId">
                <option value="" disabled selected>Select a Role</option>
                <option *ngFor="let role of roles" [value]="role.id">
                    {{ role.name }}
                </option>
                </select>
                <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['roleId'].invalid && form.controls['roleId'].touched">
                Please select a Role.
                </p>
            </div>
        </div>
    </div>
    @if(selectedRole == 3 ){
        <div class="mb-6">
            <h3 class="text-lg font-bold text-black dark:text-[#eee] mb-3">User Information</h3>
            <div class="flex flex-wrap gap-2">
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-sm font-medium text-black dark:text-gray-400 mb-2">First Name</label>
                    <input  placeholder="Enter User's First Name"
                    class="px-3 py-2 
                    text-md text-gray-800 dark:text-gray-100
                    input-class w-full 
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none" formControlName="firstName">
                    <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['firstName'].invalid && form.controls['firstName'].touched">
                    Please Enter User's First Name
                    </p>
                </div>

                <div class="flex-1 min-w-[200px]">
                    <label class="block text-sm font-medium text-black dark:text-gray-400 mb-2">Father Name</label>
                    <input  placeholder="Enter User's Father Name"
                    class="px-3 py-2 
                    text-md text-gray-800 dark:text-gray-100
                    input-class w-full 
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none" formControlName="FatherName">
                         <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['lastName'].invalid && form.controls['lastName'].touched">
                    Please Enter 's Last Name
                    </p>
                </div>

                <div class="flex-1 min-w-[200px]">
                    <label  class="block text-sm font-medium text-black dark:text-gray-400 mb-2">Last Name</label>
                    <input  placeholder="Enter User's Last Name"
                    class="px-3 py-2 
                    text-md text-gray-800 dark:text-gray-100
                    input-class w-full 
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none"  formControlName="lastName">
                    <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['lastName'].invalid && form.controls['lastName'].touched">
                    Please Enter User's Last Name
                    </p>
                </div>
            </div>
        </div>
        <!-- Phone Number -->
        <div class="mb-6">
            <div class="flex flex-wrap gap-4">
                <div class="flex-1 min-w-[250px]">
                    <label  class="block text-sm font-medium text-black dark:text-gray-400 mb-2">Phone Number</label>
                    <div class="w-full gap-4 flex-1 w">
                    <ngx-intl-tel-input
                    [cssClass]="classC" 
                    [enableAutoCountrySelect]="false"
                    [preferredCountries]="preferredCountries"
                    [enablePlaceholder]="true"
                    [enableAutoCountrySelect]="true"
                    [searchCountryFlag]="true"
                    [maxLength]="15"
                    [phoneValidation]="true"
                    [separateDialCode]="separateDialCode"
                    [selectedCountryISO]="CountryISO.Lebanon"
                    formControlName="phoneNumber"
                >
                    </ngx-intl-tel-input>
                        <p class="text-sm font-semibold text-gray-600 my-3">               
                            User Phone Number: {{ form.controls['phoneNumber'].value?.nationalNumber }}
                        </p>
                    
                    </div>
                    <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['phoneNumber'].invalid && form.controls['phoneNumber'].touched">
                    Please Enter User's Phone Number or a Valid Number
                    </p>
                    
                </div>
            </div>
        </div>
        <!-- Gender -->
        <div class="mb-6 flex gap-4">
            <!-- Male Radio Button -->
            <label class="flex items-center gap-2 cursor-pointer dark:text-white">
                <input type="radio" formControlName="theGender" value="Male" class="hidden" />
                <span class="w-5 h-5 border-2 border-gray-700 rounded-full flex items-center justify-center">
                <span
                   *ngIf="form.get('theGender')?.value === 'Male'"
                    class="w-3 h-3 bg-gray-700 dark:bg-gray-300 rounded-full"
                ></span>
            </span>
            Male
            </label>

            <!-- Female Radio Button -->
            <label class="flex items-center gap-2 cursor-pointer dark:text-white">
                <input type="radio" formControlName="theGender" value="Female" class="hidden"  />
                <span class="w-5 h-5 border-2 border-gray-700 rounded-full flex items-center justify-center">
                <span
                    *ngIf="form.get('theGender')?.value === 'Female'"
                    class="w-3 h-3 bg-gray-700 dark:bg-gray-300 rounded-full"
                ></span>
            </span>
            Female
            </label>
        </div>
        <!-- Address -->
        <div class="mb-6">
            <h3 class="text-lg font-bold text-black dark:text-[#eee] mb-3">User Address</h3>

            <div class="flex flex-wrap gap-4">
                <!-- Country -->
                <div class="flex-1 min-w-[250px]">
                    <label class="block text-sm font-medium text-black dark:text-gray-400 mb-2">Country</label>
                    <select class="px-3 py-2 
                    w-full
                    text-md text-gray-800 dark:text-gray-100
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none"
                            formControlName="country">
                    <option value="" disabled selected>Select a country</option>
                    <option *ngFor="let country of countries" [value]="country.id">
                        {{ country.name }}
                    </option>
                    <option>+ Add New Country</option>
                    </select>
                    <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['country'].invalid && form.controls['country'].touched">
                    Please select a country.
                    </p>
                </div>
                <!-- City -->
                <div class="flex-1 min-w-[250px]">
                    <label  class="block text-sm font-medium text-black dark:text-gray-400 mb-2">City</label>
                    <select class="px-3 py-2 
                    w-full
                    text-md text-gray-800 dark:text-gray-100
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none"
                            formControlName="city">
                    <option value="" disabled selected>Select a City</option>
                    <option *ngFor="let city of cities" [value]="city.id">
                        {{ city.name }}
                    </option>
                    <option>+ Add New City</option>
                    </select>
                    <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['city'].invalid && form.controls['city'].touched">
                    Please select a city.
                    </p>
                </div>
            </div>

            <div class="flex flex-wrap gap-4 my-4">
                <!-- District -->
                <div class="flex-1 min-w-[250px]">
                    <label  class="block text-sm font-medium text-black dark:text-gray-400 mb-2">District</label>
                    <select class="px-3 py-2 
                    w-full
                    text-md text-gray-800 dark:text-gray-100
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none"
                            formControlName="District">
                    <option value="" disabled selected>Select a District</option>
                    <option *ngFor="let District of districts" [value]="District.id">
                        {{ District.name }}
                    </option>
                    <option>+ Add New District</option>
                    </select>
                    <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['District'].invalid && form.controls['District'].touched">
                    Please select a District.
                    </p>
                </div>
                <!-- Street -->
                <div class="flex-1 min-w-[250px]">
                    <label  class="block text-sm font-medium text-black dark:text-gray-400 mb-2">Street</label>
                    <select class="px-3 py-2 
                    w-full
                    text-md text-gray-800 dark:text-gray-100
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none"
                            formControlName="street">
                    <option value="" disabled selected>Select a Street</option>
                    <option *ngFor="let street of streets" [value]="street.id">
                        {{ street.name }}
                    </option>
                    <option>+ Add New Street</option>
                    </select>
                    <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['street'].invalid && form.controls['street'].touched">
                    Please select a Street.
                    </p>
                </div>
            </div>
        </div>
    }
    @else if(selectedRole != 3 && selectedRole != 0 ){
        <div class="mb-6">
            <h3 class="text-lg font-bold text-black dark:text-[#eee] mb-3">User Information</h3>
            <div class="flex flex-wrap gap-2">
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-sm font-medium text-black dark:text-gray-400 mb-2">First Name</label>
                    <input  placeholder="Enter User's First Name"
                    class="px-3 py-2 
                    text-md text-gray-800 dark:text-gray-100
                    input-class w-full 
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none" formControlName="EmpfirstName">
                    <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['EmpfirstName'].invalid && form.controls['EmpfirstName'].touched">
                    Please Enter User's First Name
                    </p>
                </div>

                <div class="flex-1 min-w-[200px]">
                    <label class="block text-sm font-medium text-black dark:text-gray-400 mb-2">Father Name</label>
                    <input  placeholder="Enter User's Father Name"
                    class="px-3 py-2 
                    text-md text-gray-800 dark:text-gray-100
                    input-class w-full 
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none" formControlName="EmpFatherName">
                         <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['EmplastName'].invalid && form.controls['EmplastName'].touched">
                    Please Enter 's Last Name
                    </p>
                </div>

                <div class="flex-1 min-w-[200px]">
                    <label  class="block text-sm font-medium text-black dark:text-gray-400 mb-2">Last Name</label>
                    <input  placeholder="Enter User's Last Name"
                    class="px-3 py-2 
                    text-md text-gray-800 dark:text-gray-100
                    input-class w-full 
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none"  formControlName="EmplastName">
                    <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['EmplastName'].invalid && form.controls['EmplastName'].touched">
                    Please Enter User's Last Name
                    </p>
                </div>
            </div>
        </div>
        <!-- Phone Number -->
        <div class="mb-6">
            <div class="flex flex-wrap gap-4">
                <div class="flex-1 min-w-[250px]">
                    <label  class="block text-sm font-medium text-black dark:text-gray-400 mb-2">Phone Number</label>
                    <div class="w-full gap-4 flex-1 w">
                    <ngx-intl-tel-input
                    [cssClass]="classC" 
                    [enableAutoCountrySelect]="false"
                    [preferredCountries]="preferredCountries"
                    [enablePlaceholder]="true"
                    [enableAutoCountrySelect]="true"
                    [searchCountryFlag]="true"
                    [maxLength]="15"
                    [phoneValidation]="true"
                    [separateDialCode]="separateDialCode"
                    [selectedCountryISO]="CountryISO.Lebanon"
                    formControlName="EmpphoneNumber"
                >
                    </ngx-intl-tel-input>
                        <p class="text-sm font-semibold text-gray-600 my-3">               
                            User Phone Number: {{ form.controls['EmpphoneNumber'].value?.nationalNumber }}
                        </p>
                    
                    </div>
                    <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['EmpphoneNumber'].invalid && form.controls['EmpphoneNumber'].touched">
                    Please Enter User's Phone Number or a Valid Number
                    </p>
                    
                </div>
            </div>
        </div>
        <!-- Gender -->
        <div class="mb-6 flex gap-4">
            <!-- Male Radio Button -->
            <label class="flex items-center gap-2 cursor-pointer dark:text-white">
                <input type="radio" formControlName="EmptheGender" value="Male" class="hidden" />
                <span class="w-5 h-5 border-2 border-gray-700 rounded-full flex items-center justify-center">
                <span
                   *ngIf="form.get('EmptheGender')?.value === 'Male'"
                    class="w-3 h-3 bg-gray-700 dark:bg-gray-300 rounded-full"
                ></span>
            </span>
            Male
            </label>

            <!-- Female Radio Button -->
            <label class="flex items-center gap-2 cursor-pointer dark:text-white">
                <input type="radio" formControlName="EmptheGender" value="Female" class="hidden"  />
                <span class="w-5 h-5 border-2 border-gray-700 rounded-full flex items-center justify-center">
                <span
                    *ngIf="form.get('EmptheGender')?.value === 'Female'"
                    class="w-3 h-3 bg-gray-700 dark:bg-gray-300 rounded-full"
                ></span>
            </span>
            Female
            </label>
        </div>
        <!-- Address -->
        <div class="mb-6">
            <h3 class="text-lg font-bold text-black dark:text-[#eee] mb-3">User Address</h3>

            <div class="flex flex-wrap gap-4">
                <!-- Country -->
                <div class="flex-1 min-w-[250px]">
                    <label class="block text-sm font-medium text-black dark:text-gray-400 mb-2">Country</label>
                    <select class="px-3 py-2 
                    w-full
                    text-md text-gray-800 dark:text-gray-100
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none"
                            formControlName="Empcountry">
                    <option value="" disabled selected>Select a country</option>
                    <option *ngFor="let country of countries" [value]="country.id">
                        {{ country.name }}
                    </option>
                    <option>+ Add New Country</option>
                    </select>
                    <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['Empcountry'].invalid && form.controls['Empcountry'].touched">
                    Please select a country.
                    </p>
                </div>
                <!-- City -->
                <div class="flex-1 min-w-[250px]">
                    <label  class="block text-sm font-medium text-black dark:text-gray-400 mb-2">City</label>
                    <select class="px-3 py-2 
                    w-full
                    text-md text-gray-800 dark:text-gray-100
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none"
                            formControlName="Empcity">
                    <option value="" disabled selected>Select a City</option>
                    <option *ngFor="let city of cities" [value]="city.id">
                        {{ city.name }}
                    </option>
                    <option>+ Add New City</option>
                    </select>
                    <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['Empcity'].invalid && form.controls['Empcity'].touched">
                    Please select a city.
                    </p>
                </div>
            </div>

            <div class="flex flex-wrap gap-4 my-4">
                <!-- District -->
                <div class="flex-1 min-w-[250px]">
                    <label  class="block text-sm font-medium text-black dark:text-gray-400 mb-2">District</label>
                    <select class="px-3 py-2 
                    w-full
                    text-md text-gray-800 dark:text-gray-100
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none"
                            formControlName="EmpDistrict">
                    <option value="" disabled selected>Select a District</option>
                    <option *ngFor="let District of districts" [value]="District.id">
                        {{ District.name }}
                    </option>
                    <option>+ Add New District</option>
                    </select>
                    <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['EmpDistrict'].invalid && form.controls['EmpDistrict'].touched">
                    Please select a District.
                    </p>
                </div>
                <!-- Street -->
                <div class="flex-1 min-w-[250px]">
                    <label  class="block text-sm font-medium text-black dark:text-gray-400 mb-2">Street</label>
                    <select class="px-3 py-2 
                    w-full
                    text-md text-gray-800 dark:text-gray-100
                    bg-white dark:bg-[#2a2b2f] 
                    rounded border border-gray-300 dark:border-gray-700 
                    focus:border-[#6B7C9D] focus:ring-3 focus:ring-[#6B7C9D] focus:outline-none"
                            formControlName="Empstreet">
                    <option value="" disabled selected>Select a Street</option>
                    <option *ngFor="let street of streets" [value]="street.id">
                        {{ street.name }}
                    </option>
                    <option>+ Add New Street</option>
                    </select>
                    <p class="text-red-500 text-sm mt-1" *ngIf="form.controls['Empstreet'].invalid && form.controls['Empstreet'].touched">
                    Please select a Street.
                    </p>
                </div>
            </div>
        </div>
    }
</form>
<!-- Submit % Close buttons -->
    <div class="flex justify-end mt-6 gap-4">
        <button (click)="submit()"
                class="p-3 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition">
            Submit
        </button>
        <button (click)="closeMenu()"
                class="p-3 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition">
            Cancel
        </button>
    </div>
</app-generic-form>

@if (showConfirm) {
    <app-open-confirmation-dialog-generic 
    [title]="'Are you sure you want to submit this User?'"
    (submit)="onConfirm()"
    (close)="onCancel()">
</app-open-confirmation-dialog-generic>
}